<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="generation">

	<!-- 방생성 -->
    <insert id="insertStep1" parameterType="com.javaex.vo.ChallengeVo" useGeneratedKeys="true" keyProperty="roomNum">
    	<![CDATA[
    		INSERT INTO `roomInfo` (roomTypeNum, roomMaker, roomStatusNum)
        	VALUES (#{roomTypeNum}, #{userNum}, 1)
    	]]>
    </insert>
    
    <!-- 카테고리 등록 -->
    <update id="updateStep2" parameterType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
    		UPDATE roomInfo
			SET categoryNum = #{categoryNum},
			    roomKeyword = #{roomKeyword}
			WHERE roomNum = #{roomNum}
			AND roomMaker = #{userNum}
    	]]>
    </update>
    
    <!-- 이미지, 타이틀, 설명 등록 -->
    <update id="updateStep3" parameterType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
    		UPDATE roomInfo
			SET roomTitle = #{roomTitle},
			    roomDescription = #{roomInfo},
			    roomThumbNail = #{roomThumbNail}
			WHERE roomNum = #{roomNum}
			AND roomMaker = #{userNum}
    	]]>
    </update>
    
     <!-- 방 상세설정 업데이트 -->
    <update id="updateStep4" parameterType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
    		UPDATE roomInfo
			SET roomMaxNum = #{roomMaxNum},
			    roomMinNum = #{roomMinNum},
			    roomEnterPoint = #{roomPoint},
			    roomEnterRate = #{roomRate},
			    regionNum = #{regionNum}
			WHERE roomNum = #{roomNum}
			AND roomMaker = #{userNum}
    	]]>
    </update>
    
     <!-- 방 시작날짜+기간 업데이트 -->
    <update id="updateStep5" parameterType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
    		UPDATE roomInfo
			SET roomStartDate = #{roomStartDate},
			    periodNum = #{periodType}
			WHERE roomNum = #{roomNum}
			AND roomMaker = #{userNum}
    	]]>
    </update>
    
    <!-- 방 평가방법 업데이트 -->
    <update id="updateEvaluationType" parameterType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
    		UPDATE roomInfo
			SET evaluationType = #{evaluationType}
			WHERE roomNum = #{roomNum}
			AND roomMaker = #{userNum}
    	]]>
    </update>
    
    <!-- 방넘버 요일정보 인서트하기 -->
    <insert id="insertRoomDay" parameterType="com.javaex.vo.ChallengeVo" useGeneratedKeys="true" keyProperty="roomNum">
    	<![CDATA[
    		INSERT INTO `roomDay` (dateNum, roomNum)
        	VALUES (#{roomDayNum}, #{roomNum})
    	]]>
    </insert>
    
    <!-- 미션유의사항 업데이트 -->
    <update id="updateInstruction">
    	<![CDATA[
    		UPDATE roomInfo
			SET missionInstruction = #{missionInstruction}
			WHERE roomNum = #{roomNum}
    	]]>
    </update>
    
    <!-- 방 번호로 roomDayNum 리스트 가져오기 -->
    <select id="getRoomDayNum" parameterType="int" resultType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
        	SELECT roomDayNum
        	FROM roomDay
        	WHERE roomNum = #{roomNum}
        ]]>
    </select>

    <!-- 미션 등록 -->
    <insert id="insertMission" parameterType="com.javaex.vo.ChallengeVo" useGeneratedKeys="true" keyProperty="missionNum">
    	<![CDATA[
        	INSERT INTO challenges (missionTypeNum, roomDayNum, missionName, missionMethod, missionGoal, missionAI)
        	VALUES (#{missionTypeNum}, #{roomDayNum}, #{missionName}, #{missionMethod}, #{missionGoal}, #{missionAI})
        ]]>
    </insert>

    <!-- 미션별 이미지 등록 -->
    <insert id="missionImageInsert" parameterType="com.javaex.vo.ChallengeVo">
    	<![CDATA[
	        INSERT INTO missionImg (missionNum, missionImgName)
    	    VALUES (#{missionNum}, #{missionImgName})
    	]]>
    </insert>
    
    
</mapper>
